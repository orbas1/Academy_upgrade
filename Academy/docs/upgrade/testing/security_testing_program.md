# Section 12.5 – Security Testing Program

This document records the operational plan for security testing across the Academy web platform and Flutter mobile applications. It closes Section 12.5 (Preparation & Remediation) of the upgrade roadmap.

## 1. Threat Modeling & Coverage Map

| Asset / Surface | Primary Threats | Existing Controls | Planned Enhancements |
| --- | --- | --- | --- |
| Laravel API (Communities, Payments, Webhooks) | Injection, auth bypass, privilege escalation, insecure deserialization | Form requests, policy matrix, Sanctum session scoping | Continuous SAST (Larastan/PHPStan), ZAP authenticated baseline, contract tests for Stripe webhooks |
| Real-time services (Broadcast, Notifications) | Replay, message tampering, websocket abuse | Signed broadcast channels, Redis rate limits | Session-bound tokens, anomaly detection metrics fed to SIEM |
| Media uploads (S3) | Malware payloads, PII leakage, bucket takeover | ClamAV queue, object ACL hardening, lifecycle rules | Automated quarantine release approvals, S3 inventory audit |
| Flutter mobile app | MITM, insecure storage, tampered packages | HTTPS pinning, secure storage wrappers, obfuscation | Dependency review pipeline, Firebase App Check, runtime jailbreak/root detection |
| Admin Dashboard | CSRF, stored XSS, report tampering | CSP, anti-CSRF tokens, immutable audit logs | Quarterly manual penetration testing, privileged session timeout policies |

Outputs from threat modeling sessions are versioned in `docs/upgrade/` and reviewed quarterly with security engineering and product.

## 2. Security Scan Scheduling

| Activity | Owners | Cadence | Automation |
| --- | --- | --- | --- |
| Composer / npm / Flutter dependency audit | Platform Eng. | On every PR + weekly cron | `.github/workflows/security-scan.yml` jobs `php-security`, `node-audit`, `flutter-audit` |
| Static Analysis (Larastan/PHPStan) | Platform Eng. | On every PR | `php-security` job |
| Trivy filesystem scan | DevOps | Weekly cron | `security-scan.yml` (`tooling-smoke-test`) |
| OWASP ZAP baseline (staging URL) | Security Eng. | Weekly + manual dispatch | `security-scan.yml` `owasp-zap` job + `tools/security/zap/run_baseline.sh` |
| External penetration test | Third-party vendor | Twice yearly (pre-major release) | Vendor statement of work, tracked in risk register |
| Threat model review | Architecture & Security | Quarterly | Workshop + update to this document |

The ZAP baseline job requires secrets `ZAP_BASELINE_TARGET`, optional `ZAP_AUTH_*` headers for authenticated scans, and publishes HTML/JSON/Markdown artifacts for audit.

## 3. Remediation Workflow

1. **Triage** – CI fails on HIGH/CRITICAL findings. Medium severity alerts auto-create Jira tickets with a 5 business day SLA; low severity tracked in backlog with quarterly sweep.
2. **Assignment** – Security engineering assigns owners based on component (Laravel API, mobile, infrastructure). The ticket references artifact URLs from the ZAP or dependency scans.
3. **Fix & Verification** – Engineers patch, add regression tests, and link commits to the security ticket. The relevant scan (Composer audit, npm audit, Flutter outdated, ZAP baseline) is re-run via `workflow_dispatch` to confirm resolution.
4. **Closure** – Security engineering reviews the updated `zap-summary.md` or dependency audit output. Tickets are closed only when scans return clean and regression tests are merged.

The helper script `tools/security/security_scan.sh` mirrors the CI checks for local verification. It also supports running the OWASP ZAP baseline locally when `ZAP_BASELINE_TARGET` is set, storing summaries in a temporary directory and surfacing them in the console for quick risk assessment.

## 4. Evidence & Reporting

- All CI runs upload artifacts (`zap-baseline-report`, Composer audit logs) retained for 45 days.
- Summaries generated by `summarize_zap.py` are ingested into the compliance knowledge base and linked within the risk register (Section 19).
- Security scorecards track four dimensions (Functionality, Integration, UX, Security) and are updated once remediation is verified.

## 5. Penetration Test Prep Checklist

Before engaging the external penetration vendor:

- [x] Publish latest API schema & architecture diagrams in the vendor portal.
- [x] Provide dedicated staging credentials with RBAC coverage (admin, moderator, student, mobile user).
- [x] Enable verbose logging + S3 log archival for the duration of the test.
- [x] Freeze non-essential deployments; communicate maintenance windows to stakeholders.
- [x] Provide mobile app beta builds (Android internal track, TestFlight) with debugging disabled and analytics opt-in toggled.

Post-test, findings are logged into the remediation workflow above and traced to closure with verification scans.

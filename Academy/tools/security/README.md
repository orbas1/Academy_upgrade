# Security Scan Toolkit

The `security_scan.sh` helper consolidates the recurring security checks required for the Communities upgrade program.

## Prerequisites
- PHP 8.3+, Composer 2.7+
- Node.js 20+ and npm
- Flutter 3.22+
- [Docker](https://docs.docker.com/get-docker/) (for OWASP ZAP baseline)
- (Optional) [Trivy](https://aquasecurity.github.io/trivy/v0.50/) for filesystem scanning

## Usage
```bash
cd Academy/tools/security
./security_scan.sh
```

The script performs the following steps:
1. Installs PHP dependencies for the Laravel application without running framework scripts.
2. Executes `composer audit --locked` to detect known vulnerabilities.
3. Runs Larastan (PHPStan) static analysis with the hardened `phpstan.neon.dist` profile.
4. Executes `npm ci` followed by a production-scoped `npm audit --omit=dev`.
5. Refreshes Flutter dependencies and reports outdated packages that require review for CVEs.
6. Invokes Trivy (if available) to scan the repository for HIGH/CRITICAL vulnerabilities.
7. Launches an OWASP ZAP baseline scan (when `ZAP_BASELINE_TARGET` is defined) and summarises findings via `zap/summarize_zap.py`.

All commands emit ISO-8601 timestamps so the resulting logs can be ingested by centralized monitoring during scheduled security windows.

## OWASP ZAP Baseline Toolkit

The `zap/` subdirectory exposes automation to exercise the DAST workflow locally:

- `run_baseline.sh` – convenience wrapper around the official ZAP Docker image. Provide the target URL with `ZAP_BASELINE_TARGET` or as the first argument. Reports are stored in the directory referenced by `ZAP_OUTPUT_DIR` (defaults to a temporary directory).
- `summarize_zap.py` – parses the JSON report generated by `zap-baseline.py` and emits machine-readable (`zap-summary.json`) and human-readable (`zap-summary.md`) summaries.
- `sample_zap_report.json` – fixture mirroring the JSON schema used by automated tests and CI summarisation.

Example invocation:
```bash
export ZAP_BASELINE_TARGET="https://staging.academy.example"
./zap/run_baseline.sh
```

The GitHub Actions workflow `.github/workflows/security-scan.yml` runs the same toolkit on a weekly schedule (or manual trigger) when the `ZAP_BASELINE_TARGET` secret is configured, publishing the HTML/JSON/Markdown artifacts for security review and ticketing.
